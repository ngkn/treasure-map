(this["webpackJsonptreasure-map"]=this["webpackJsonptreasure-map"]||[]).push([[0],{16:function(e,t,r){},20:function(e,t,r){},21:function(e,t,r){"use strict";r.r(t);var n=r(1),a=r.n(n),i=r(11),o=r.n(i),l=(r(16),r(3)),c=r(0),s=Object(n.createContext)(null);function u(){return Object(n.useContext)(s)}function v(e){var t=e.children,r=Object(n.useState)(0),a=Object(l.a)(r,2),i=a[0],o=a[1],u=Object(n.useState)(0),v=Object(l.a)(u,2),d=v[0],m=v[1],y=Object(n.useState)([]),h=Object(l.a)(y,2),j=h[0],b=h[1],p=Object(n.useState)([]),f=Object(l.a)(p,2),O=f[0],g=f[1],z=Object(n.useState)([]),x=Object(l.a)(z,2),M=x[0],A=x[1],N=Object(n.useState)(!1),S=Object(l.a)(N,2),C=S[0],E=S[1];return Object(c.jsx)(s.Provider,{value:{widthMap:i,lengthMap:d,mountains:j,treasures:O,adventurers:M,isAlreadyAMap:C,setWidthMap:function(e){o(e)},setLengthMap:function(e){m(e)},setMountains:function(e){b(e)},setTreasures:function(e){g(e)},setAdventurers:function(e){A(e)},getRemainingMoves:function(){var e;return M&&(e=M.map((function(e){return e.movements.length})).reduce((function(e,t){return e+t}),0)),e||0},setisAlreadyAMap:function(e){E(e)}},children:t})}var d=r(2),m=r(4);var y=r(7);function h(e,t,r,n,a,i){var o=Object(d.a)(t),l=Object(d.a)(e),c=Object(d.a)(r),s=Object(d.a)(n),u=function(e){var t=[];return Object(d.a)(e).forEach((function(e){var r=Object(y.a)({},e);"N"===r.orientation&&(r.horizontally-=1),"S"===r.orientation&&(r.horizontally+=1),"E"===r.orientation&&(r.vertically+=1),"O"===r.orientation&&(r.vertically-=1);var n={id:e.id,nextMove:String(r.horizontally)+String(r.vertically),priority:e.priority};t=[].concat(Object(d.a)(t),[n])})),Object(d.a)(t.reduce((function(e,t){return e.set(t.nextMove,(e.get(t.nextMove)||[]).concat(t))}),new Map).values()).map((function(e){return e.reduce((function(e,t){return t.priority<e.priority?t:e}))}))}(o);return c.forEach((function(e){u.forEach((function(t){if(t.id===e.id){var r=function(e,t,r){var n=Object(y.a)({},e);return"N"===n.orientation&&n.horizontally>0&&(n.horizontally-=1),"S"===n.orientation&&n.horizontally<t-1&&(n.horizontally+=1),"E"===n.orientation&&n.vertically<r-1&&(n.vertically+=1),"O"===n.orientation&&n.vertically>0&&(n.vertically-=1),n}(e,a,i),n=Object(y.a)({},e),o=l[e.vertically][e.horizontally],c=l[r.vertically][r.horizontally],u=l[n.vertically][n.horizontally];if(c.isAdventurer||"mountain"===c.type)e.movements=e.movements.substring(1);else{if(e.horizontally=r.horizontally,e.vertically=r.vertically,"treasure"!==c.type&&"treasureAdventurer"!==c.type||(c.total&&(c.total-=1,e.treasureRecovered+=1,s.forEach((function(e){e.idTreasure===c.idTreasure&&e.total>0&&(e.total-=1)}))),c.type="treasureAdventurer",o.id=e.id,o.type="adventurer",o.symbol="A(".concat(e.name,")"),o.orientation=e.orientation,o.movements=e.movements,o.priority=e.priority,o.treasureRecovered=e.treasureRecovered+1,o.isAdventurer=!0),"plain"===c.type&&(e.horizontally=r.horizontally,e.vertically=r.vertically,l[r.vertically][r.horizontally]={},c.id=e.id,c.type="adventurer",c.symbol="A(".concat(e.name,")"),c.orientation=e.orientation,c.movements=e.movements,c.priority=e.priority,c.treasureRecovered=e.treasureRecovered,l[r.vertically][r.horizontally].isAdventurer=!0),"treasureAdventurer"!==u.type&&(l[n.vertically][n.horizontally]={type:"plain",symbol:"*",isAdventurer:!1,x:n.horizontally,y:n.vertically}),"treasureAdventurer"===u.type){var v=l[n.vertically][n.horizontally].idTreasure;l[n.vertically][n.horizontally]={},s.forEach((function(e){e.idTreasure===v&&(l[n.vertically][n.horizontally]={idTreasure:e.idTreasure,type:"treasure",symbol:"T(".concat(e.total,")"),total:e.total})}))}e.movements=e.movements.substring(1)}}}))})),{adventurersClone:c,mapClone:l}}var j=function(e){var t=e.handleResult,r=u(),a=r.widthMap,i=r.lengthMap,o=r.mountains,s=r.treasures,v=r.adventurers,y=r.isAlreadyAMap,j=r.getRemainingMoves,b=r.setAdventurers,p=r.setisAlreadyAMap,f=new Array(i).fill(null).map((function(e,t){return new Array(a).fill(null).map((function(e,r){return{type:"plain",symbol:"*",isAdventurer:!1,x:t,y:r}}))})),O=Object(n.useState)(f),g=Object(l.a)(O,2),z=g[0],x=g[1],M=Object(n.useState)(),A=Object(l.a)(M,2),N=A[0],S=A[1];return Object(n.useEffect)((function(){if(y)x(f),p(!1);else{if(o){var e=function(e,t){var r=Object(d.a)(e);return t.forEach((function(e){r[e.vertically][e.horizontally].type="mountain",r[e.vertically][e.horizontally].symbol="M"})),r}(z,o);x(Object(d.a)(e))}if(s){var r=function(e,t){var r=Object(d.a)(e);return t.forEach((function(e){r[e.vertically][e.horizontally].idTreasure=e.idTreasure,r[e.vertically][e.horizontally].type="treasure",r[e.vertically][e.horizontally].symbol="T(".concat(e.total,")"),r[e.vertically][e.horizontally].total=e.total})),r}(z,s);x(Object(d.a)(r))}if(v){var n=function(e,t){var r=Object(d.a)(e);return t.forEach((function(e){r[e.vertically][e.horizontally].id=e.id,r[e.vertically][e.horizontally].name=e.name,r[e.vertically][e.horizontally].type="adventurer",r[e.vertically][e.horizontally].symbol="A(".concat(e.name,")"),r[e.vertically][e.horizontally].orientation=e.orientation,r[e.vertically][e.horizontally].movements=e.movements,r[e.vertically][e.horizontally].priority=e.priority,r[e.vertically][e.horizontally].treasureRecovered=0,r[e.vertically][e.horizontally].isAdventurer=!0})),r}(z,v);x(Object(d.a)(n)),S(j())}0===v.length&&t({widthMap:a,lengthMap:i,mountains:o,treasures:s,adventurers:v})}}),[o,s,v,y]),Object(n.useEffect)((function(){if(N){var e=setTimeout((function(){var e=function(e){var t=e.map,r=e.widthMap,n=e.lengthMap,a=e.adventurers,i=e.treasures,o=Object(d.a)(a),l=[],c=Object(d.a)(t);if(o.forEach((function(e){var t=e.movements.slice(0,1);if("A"!==t&&t){var r=function(e,t){switch(!0){case"N"===t&&"D"===e:return"E";case"N"===t&&"G"===e:case"S"===t&&"D"===e:return"O";case"S"===t&&"G"===e:return"E";case"E"===t&&"D"===e:return"S";case"E"===t&&"G"===e:case"O"===t&&"D"===e:return"N";case"O"===t&&"G"===e:return"S";default:return""}}(t,e.orientation);e.orientation=r,e.movements=e.movements.substring(1)}else t.length&&(l=[].concat(Object(d.a)(l),[e]))})),l.length){var s=h(c,l,o,i,r,n),u=s.adventurersClone,v=s.mapClone;o=Object(d.a)(u),c=Object(d.a)(v)}return{mapCopy:c,adventurersCopy:o}}({map:z,widthMap:a,lengthMap:i,adventurers:v,treasures:s}),t=e.mapCopy,r=e.adventurersCopy;x(Object(d.a)(t)),b(Object(d.a)(r))}),1e3);return function(){return clearTimeout(e)}}0===N&&t({widthMap:a,lengthMap:i,mountains:o,treasures:s,adventurers:v})}),[N]),Object(c.jsx)("div",{className:"mapContainer",children:Object(c.jsx)("div",{className:"mapWrapper",children:z&&z.map((function(e,t){return Object(c.jsxs)("div",{className:"horizontallyContainer",children:[Object(c.jsx)("div",{className:"indexHorizontally",children:t}),Object(c.jsx)("div",{className:"mapItemContainer",children:e.map((function(e,r){return Object(c.jsxs)("div",{className:"verticallyContainer",children:[Object(c.jsx)("div",{className:"mapItem",children:e.symbol}),0===t&&Object(c.jsx)("div",{className:"indexVertically",children:r})]},Object(m.v4)())}))})]},Object(m.v4)())}))})})},b=function(e){var t=e.elementsOutput,r=t&&t.mapLine,n=t&&t.mountainsLine||null,a=t&&t.treasuresLine||null,i=t&&t.adventurersLine||null;return Object(c.jsxs)("div",{className:"outputWrapper",children:[Object(c.jsx)("div",{children:r}),n&&n.map((function(e){return Object(c.jsx)("div",{children:e},Object(m.v4)())})),a&&a.map((function(e){return Object(c.jsx)("div",{children:e},Object(m.v4)())})),i&&i.map((function(e){return Object(c.jsx)("div",{children:e},Object(m.v4)())}))]})};function p(e){return e.split(/[- ]/).filter(Boolean)}function f(e){var t=Object(d.a)(e),r=t.shift()||"",n=function(e,t){var r={},n=/^[Cc]\s-\s[1-9]\s-\s[1-9]$/gm.test(e),a=p(e),i=Number(a[1]),o=Number(a[2]);return n&&i!==o&&i*o>=t&&(r={width:i,length:o}),r}(r,t.length);return 0===Object.keys(n).length?{}:{mapValid:n,elementsValid:function(e,t){var r=!0,n=[],a=[],i=[],o=p(t),l=Number(o[1])-1,c=Number(o[2])-1,s=e.map((function(e,t){var o,s=p(e),u=/^[Cc]/.test(e),v=/^[Aa]/.test(e),d=/^[Mm]/.test(e),m=/^[Tt]/.test(e),y=/^[Mm]\s-\s[0-9]\s-\s[0-9]$/gm.test(e),h=/^[Tt]\s-\s[0-9]\s-\s[0-9]\s-\s[1-9]$/gm.test(e),j=function(e){return/^[Aa]\s-\s[a-zA-Z]{1,10}\s-\s[0-9]\s-\s[0-9]\s-\s[Nn|Ss|Oo|Ee]\s-\s[Aa|Dd|Gg]{1,20}$/gm.test(e)}(e),b=y||h||j,f=Number(s[1])>l||Number(s[2])>c,O=Number(s[2])>l||Number(s[3])>c;b||(r=!1),u&&(r=!1),(d||m)&&f&&(r=!1),v&&O&&(r=!1);var g=Number(v?s[2]:s[1]),z=Number(v?s[3]:s[2]);return d&&(o=s[1]+s[2],n.push({id:"mountain-".concat(t),horizontally:g,vertically:z,type:"mountain"})),m&&(o=s[1]+s[2],a.push({idTreasure:"treasure-".concat(t),horizontally:g,vertically:z,total:Number(s[3]),type:"treasure"})),v&&(o=s[2]+s[3],i.push({id:"adventurer-".concat(t),name:s[1],horizontally:g,vertically:z,orientation:s[4],movements:s[5],priority:t+1,treasureRecovered:0,type:"adventurer"})),o}));return s.some((function(e,t){return t!==s.indexOf(e)}))&&(r=!1),{mountains:n,treasures:a,adventurers:i,isValid:r}}(t,r)}}var O=function(e){var t=e.handleMapCreation,r=e.resetResult,a=Object(n.useRef)(null),i=Object(n.useState)(!1),o=Object(l.a)(i,2),s=o[0],v=o[1],d=u(),m=d.isAlreadyAMap,y=d.setWidthMap,h=d.setLengthMap,j=d.setMountains,b=d.setTreasures,p=d.setAdventurers,O=d.setisAlreadyAMap;return Object(n.useEffect)((function(){s&&t(s),r(m)}),[s,m]),Object(c.jsx)(c.Fragment,{children:Object(c.jsxs)("form",{"data-test":"formEntryFile",className:"formEntryFileStyle",onSubmit:function(e){if(a.current){var t=f(function(e){var t=/(\r\n|\n|\r)/gm;return e.split(/^/gm).map((function(e){return e.replace(t,"")})).filter(Boolean)}(a.current.value));0!==Object.keys(t).length&&t.elementsValid.isValid&&(s&&O(!0),y(t.mapValid.width),h(t.mapValid.length),j(t.elementsValid.mountains),b(t.elementsValid.treasures),p(t.elementsValid.adventurers),v(!0)),e.preventDefault()}},children:[Object(c.jsx)("div",{children:Object(c.jsx)("textarea",{name:"textEntryFile",cols:30,rows:10,ref:a})}),Object(c.jsx)("button",{type:"submit",children:"Valider"})]})})};r(20);var g=function(){var e=Object(n.useState)(!1),t=Object(l.a)(e,2),r=t[0],a=t[1],i=Object(n.useState)(!1),o=Object(l.a)(i,2),s=o[0],u=o[1],d=Object(n.useState)(),m=Object(l.a)(d,2),y=m[0],h=m[1];return Object(c.jsx)("div",{className:"App",children:Object(c.jsx)(v,{children:Object(c.jsxs)("div",{className:"GameContainer",children:[Object(c.jsx)("h1",{children:"Treasure map"}),Object(c.jsx)("div",{children:Object(c.jsx)(O,{handleMapCreation:function(e){return e&&a(!0)},resetResult:function(e){return e&&u(!1)}})}),r&&Object(c.jsx)(j,{handleResult:function(e){var t=function(e){var t="C - ".concat(e.widthMap," - ").concat(e.lengthMap),r=[],n=[],a=[];return e.mountains.length&&(r=e.mountains.map((function(e){return"M - ".concat(e.horizontally," - ").concat(e.vertically)}))),e.treasures.length&&(n=e.treasures.map((function(e){return"T - ".concat(e.horizontally," - ").concat(e.vertically," - ").concat(e.total)}))),e.adventurers.length&&(a=e.adventurers.map((function(e){return"A - ".concat(e.name," - ").concat(e.horizontally," - ").concat(e.vertically," - ").concat(e.orientation," - ").concat(e.treasureRecovered)}))),{mapLine:t,mountainsLine:r,treasuresLine:n,adventurersLine:a}}(e);h(t),u(!0)}}),s&&Object(c.jsxs)("div",{className:"outputContainer",children:[Object(c.jsx)("h3",{className:"outputTitle",children:"R\xe9sultat"}),Object(c.jsx)(b,{elementsOutput:y})]})]})})})},z=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,22)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;r(e),n(e),a(e),i(e),o(e)}))};o.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(g,{})}),document.getElementById("root")),z()}},[[21,1,2]]]);
//# sourceMappingURL=main.79f6ecfd.chunk.js.map